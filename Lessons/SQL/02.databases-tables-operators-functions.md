# Databases, tables, operators, functions

- [Databases, tables, operators, functions](#databases-tables-operators-functions)
	- [Intro](#intro)
	- [Comments](#comments)
	- [Databases](#databases)
	- [Tables](#tables)
		- [`CREATE`](#create)
		- [`SHOW`](#show)
		- [`DESC`](#desc)
		- [`SHOW CREATE TABLE`](#show-create-table)
		- [`ALTER`](#alter)
	- [Operators](#operators)
	- [Aliases](#aliases)
	- [Aggregate functions](#aggregate-functions)
		- [`COUNT()`](#count)
		- [`AVG()`](#avg)
		- [`SUM()`](#sum)
		- [`MIN()`, `MAX()`](#min-max)

***

## Intro

All expressions can be written in a **single line or in multiple lines** - doesn't matter. 

Every expression should end with a semicolon `;`

All **commands** are case-**insensitive** (`SELECT === select`). Here we gonna write them in UPPERCASE for distinction.

All **names** of the tables, fields, etc. are case-**sensitive** (`Planets !== planets`)

***


## Comments

```sql
-- Single-line

/* Multi-
line */
```

***


## Databases

First, we create a database and switch to it:

```sql
/* create new database */
CREATE DATABASE test;

/* show all databases */
show databases;

/* select a database to not write its name over and over */
use test;
```

***


## Tables

Information is stored in tables. 

### `CREATE`

Create a table.

```sql
CREATE TABLE Person (
	person_id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
	username VARCHAR(64),
	surname VARCHAR(64),
	father_name VARCHAR(64)
);
```

### `SHOW`

Show the list of your tables.

```sql
SHOW TABLES;
```

### `DESC`

Describe the structure of your table:

```sql
DESC person;
```

![](img/2020-10-10-22-29-19.png)

### `SHOW CREATE TABLE`

Show the instruction how to create such a table. 

**Be careful**: the result is **not** exactly what you need to type to create such a table. Particularly, you might need to delete **single quotes** around the table name and the field names. 

```sql
SHOW CREATE TABLE person;
```

***

### `ALTER`

Changes table or columns.

```sql
/* Add columns */

ALTER TABLE contacts
/* add after the column `contact_id` */
ADD last_name varchar(40) NOT NULL AFTER contact_id,	
/* make the 1st column */
ADD first_name varchar(35) NULL FIRST;	


/* Delete columns */

ALTER TABLE animals 
DROP COLUMN last_name, 
DROP COLUMN first_name;


/* Modify columns */

ALTER TABLE contacts
MODIFY last_name varchar(55) NULL AFTER contact_type,
MODIFY first_name varchar(30) NOT NULL;


/* Change the AUTO_INCREMENT default value */

ALTER TABLE test AUTO_INCREMENT = 100;


/* Rename columns */

ALTER TABLE Person CHANGE COLUMN 
	name /* old name */
	firstname VARCHAR(64); /* new name and definition */
--[ FIRST | AFTER column_name ]


/* Rename a table */

ALTER TABLE table_name 
RENAME TO new_table_name;


/* Add index */

ALTER TABLE person 
ADD INDEX (date_of_birth);
```

***


## Operators

https://www.w3schools.com/sql/sql_operators.asp

Arithmetic|Description
-|-
`+`|Add	
`-`|Subtract	
`*`|Multiply	
`/`|Divide	
`%`|Modulo

Compound|Description
-|-
`+=`|Add equals
`-=`|Subtract equals
`*=`|Multiply equals
`/=`|Divide equals
`%=`|Modulo equals

Bitwise|Bitwise
-|-
`&`|Bitwise AND
`|`|Bitwise OR
`^`|Bitwise exclusive OR
`&=`|Bitwise AND equals
`^-=`|Bitwise exclusive equals
`|*=`|Bitwise OR equals

Comparison|Description
-|-
`=`|Equal to	
`>`|Greater than	
`<`|Less than	
`>=`|Greater than or equal to	
`<=`|Less than or equal to	
`<>` or `!=`|Not equal to

Logical|Example|Description
-|-|-
`AND`||TRUE if all the conditions separated by AND is TRUE
`OR`||TRUE if any of the conditions separated by OR is TRUE	
`ALL`|`WHERE Price > ALL (SELECT Price FROM Products WHERE Price > 500);`|TRUE if all of the subquery values meet the condition
`ANY`|same|TRUE if any of the subquery values meet the condition	
`BETWEEN`|`BETWEEN 20 AND 30`|Inclusive. 
`EXISTS`|`WHERE EXISTS (SELECT Price FROM Products WHERE Price > 50);`|TRUE if the subquery returns one or more records. If the example subquery returns at least one record with `price > 50` = `EXISTS` is fulfilled.
`IN`|`IN ('Paris', 'London)`|TRUE if in the list of multiple possible values
`LIKE`|`SELECT planet_name, opening_year, opener FROM Planets WHERE planet_name NOT LIKE '%s' AND planet_name NOT LIKE 'S%';`|TRUE if the operand matches a pattern: select 3 fields of the records which planet_name does **not** ends or starts with 's'. 
`NOT`||Displays a record if the condition(s) is NOT TRUE	
`SOME`||TRUE if any of the subquery values meet the condition

**Examples**

Find small planets (<10000 radius) opened after 1620:

```sql
SELECT * FROM Planets WHERE radius < 10000 AND opening_year > 1620;
```

![](img/2020-12-22-03-46-53.png)

Find planets starting with 'N' or ending with 's' that don't have rings:

```sql
SELECT * FROM Planets WHERE (planet_name LIKE 'N%' OR planet_name LIKE '%s') AND has_rings = 0;
```

![](img/2020-12-22-03-52-21.png)

***

## Aliases

Aliases are used to give a table, or a column in a table, a temporary name.

An alias only exists for the duration of the query.

You may apply it to any columns in your search results you need.

Without alias:

```sql
SELECT planet_name, opener FROM Planets;
```

![](img/2020-12-21-17-02-01.png)

With alias:

```sql
SELECT planet_name AS Planet, opener FROM Planets;
```

![](img/2020-12-21-17-01-40.png)

Complex alias **combined** of 3 fields: 

```sql
SELECT 
	CustomerName, 
	Address + ', ' + PostalCode + ' ' + City + ', ' + Country AS Address
FROM Customers;
```

![](img/2020-12-21-17-09-26.png)

***


## Aggregate functions

Functions that return a **single** value after processing multiple records.

### `COUNT()`

The number of rows that matches a specified criterion

```sql
SELECT COUNT(Album) from Artists;
```

![](img/2020-12-21-15-37-15.png)

### `AVG()`

The average value of a numeric column

```sql
SELECT AVG(Sale) AS 'Average Sales' FROM Artists WHERE Singer = 'Drowning Pool';
```

![](img/2020-12-21-17-36-42.png)

***

### `SUM()`

The sum of a numeric column

```sql
SELECT Singer, SUM(Sale) AS AllSales 
FROM Artists 
GROUP BY Singer;
```

![](img/2020-12-21-15-45-10.png)

***

### `MIN()`, `MAX()`

The smallest and the largest value of the column

```sql
SELECT MIN(Sale) from Artists;
```

![](img/2020-12-21-17-44-30.png)

```sql
SELECT MAX(Sale) from Artists 
```
