<!DOCTYPE html>

<body>
	<form name="myform">
		<input type="text" name="nick" value="Max"><br>
		<input type="text" name="msg" value="Hello, World!"><br>
		<button type="submit">Submit</button>
	</form>

	<secrion id="messages"></secrion>

	<script src="/socket.io/socket.io.js"></script>
	<script>
		const socket = io()
		localStorage.debug = 'socket.io-client:socket'

		$form = document.forms.myform
		$messages = document.getElementById('messages')

		$form.addEventListener('submit', e => {
			e.preventDefault()
			// Forbid empty fields
			if (!$form.elements.nick.value || !$form.elements.msg.value) {
				return
			}

			const message = {
				nick: $form.elements.nick.value,
				msg: $form.elements.msg.value
			}

			// Render the message for the sender
			renderMessage(message)

			// Send the message for the rest of users
			socket.emit('chat message', message)
			$form.elements.msg.value = ''
		})

		socket.on('chat message', renderMessage)

		function renderMessage(data) {
			const message = document.createElement('article')
			$messages.prepend(message)
			message.innerHTML = `<b>${data.nick}:</b> ${data.msg}`
		}
	</script>
</body>